{"version":3,"sources":["/vendor/ane/components/ms-table/ms-table.ts"],"names":[],"mappings":"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","file":"ms-table.js","sourcesContent":["import * as avalon from 'avalon2';\nimport '../ms-checkbox/ms-checkbox';\nimport '../ms-pagination/ms-pagination';\nimport {\n    findParentComponent,\n    parseSlotToVModel,\n    getChildTemplateDescriptor\n} from '../../ane-util';\nimport '../ms-loading';\n\nconst defaultPagination = function () {\n    return {\n        current: 1, pageSize: 10, total: NaN, onChange: avalon.noop\n    };\n};\n\navalon.component('ms-table', {\n    soleSlot: 'header',\n    template: __inline('./ms-table.html'),\n    defaults: {\n        header: '',\n        columns: [],\n        data: [],\n        key: 'id',\n\n        loading: false,\n        needSelection: false,\n        checked: [],\n        selection: [],\n        isAllChecked: false,\n        onSelect: avalon.noop,\n        onSelectAll: avalon.noop,\n        selectionChange: avalon.noop,\n        handleCheckAll(e) {\n            const data = this.getCurrentPageData();\n            if (e.target.checked) {\n                data.forEach(record => {\n                    this.checked.ensure(record[this.key]);\n                    this.selection.ensure(record);\n                });\n            } else {\n                if (!isNaN(this.paginationConfig.total)) {\n                    this.checked.clear();\n                    this.selection.clear();\n                } else {\n                    this.checked.removeAll(el => data.map(record => record[this.key]).indexOf(el) !== -1);\n                    this.selection.removeAll(el => data.indexOf(el) !== -1);\n                }\n            }\n            this.selectionChange(this.checked, this.selection.$model);\n            this.onSelectAll(e.target.checked, this.selection.$model);\n        },\n        handleCheck(checked, record) {\n            if (checked) {\n                this.checked.ensure(record[this.key]);\n                this.selection.ensure(record);\n            } else {\n                this.checked.remove(record[this.key]);\n                this.selection.remove(record);\n            }\n            this.selectionChange(this.checked, this.selection.$model);\n            this.onSelect(record.$model, checked, this.selection.$model);\n        },\n\n        actions: {},\n        handle(type, col, record, $index, ...extra) {\n            let text = record[col.dataIndex].$model || record[col.dataIndex];\n            this.actions(type, text, record.$model, $index, ...extra);\n        },\n\n        pagination: defaultPagination(),\n        paginationConfig: defaultPagination(),\n        handlePageChange(currentPage) {\n            this.paginationConfig.onChange(currentPage);\n            this.paginationConfig.current = currentPage;\n\n            this.$fire('checked.length', this.checked.length);\n            this.onChange(this.paginationConfig.$model);\n        },\n        getCurrentPageData() {\n            return !isNaN(this.paginationConfig.total) ? this.data : this.data.slice(\n                this.paginationConfig.pageSize * (this.paginationConfig.current - 1),\n                this.paginationConfig.pageSize * this.paginationConfig.current\n            );\n        },\n        $computed: {\n            total() {\n                return !isNaN(this.paginationConfig.total) ? this.paginationConfig.total : this.data.length;\n            }\n        },\n\n        onChange: avalon.noop,\n        onInit(event) {\n            const descriptor = getChildTemplateDescriptor(this);\n            descriptor.forEach(column => {\n                if (column.props.type == 'selection') {\n                    this.key = column.props.dataIndex || this.key;\n                    this.needSelection = true;\n                    return false;\n                }\n            });\n            this.columns = getColumnConfig(descriptor);\n            this.$watch('checked.length', (newV) => {\n                const currentPageKeys = this.getCurrentPageData()\n                    .map(record => record[this.key]);\n                this.isAllChecked = currentPageKeys\n                    .filter(key => this.checked.contains(key))\n                    .length == currentPageKeys.length;\n            });\n            this.$watch('data', (v) => {\n                this.isAllChecked = false;\n                this.checked.clear();\n                this.selection.clear();\n            });\n            this.$watch('data.length', v => {\n                this.isAllChecked = false;\n                this.checked.clear();\n                this.selection.clear();\n            });\n            this.$watch('pagination', v => {\n                avalon.mix(this.paginationConfig, v);\n            });\n            this.$watch('pagination.current', v => {\n                this.paginationConfig.current = v;\n            });\n            this.$watch('pagination.pageSize', v => {\n                this.paginationConfig.pageSize = v;\n            });\n            this.$watch('pagination.total', v => {\n                this.paginationConfig.total = v;\n            });\n            this.$watch('pagination.onChange', v => {\n                this.paginationConfig.onChange = v;\n            });\n            this.$fire('pagination', this.pagination.$model);\n        },\n        onReady(event) {\n        },\n        onDispose(vm, el) {\n        }\n    }\n});\n\nfunction getColumnConfig(descriptor, level = 1) {\n    return descriptor.reduce((acc, column) => {\n        if (column.is != 'ms-table-header') return acc;\n        if (column.props.type == 'selection') {\n            return acc;\n        }\n        let inlineTemplate = column.inlineTemplate;\n        inlineTemplate = inlineTemplate.replace(/(ms-|:)skip=\"[^\"]*\"/g, '');\n        inlineTemplate = inlineTemplate.replace(/<\\s*ms-table-header[^>]*>.*<\\/\\s*ms-table-header\\s*>/g, '');\n        inlineTemplate = inlineTemplate.replace(/(ms-|:)click=\"handle\\(([^\"]*)\\)\"/g, ($0, $1, $2, $3) => {\n            return `${$1}click=\"handle(${$2},)\"`.replace(/,/, ', col, record, $index,').replace(/,\\)/, ')');\n        });\n        acc.push({\n            title: column.props.title,\n            dataIndex: column.props.dataIndex || '',\n            template: /^\\s*$/.test(inlineTemplate) ? '{{record.' + column.props.dataIndex + '}}' : inlineTemplate\n        });\n        return acc.concat(getColumnConfig(column.children, level + 1));\n    }, []);\n}"]}