{"version":3,"sources":["/vendor/ane/components/ms-calendar/ms-calendar.ts"],"names":[],"mappings":"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","file":"ms-calendar.js","sourcesContent":["import * as avalon from 'avalon2';\nimport * as moment from 'moment';\nimport 'moment/locale/zh-cn';\nimport '../ms-select';\nimport './ms-calendar-year-view';\nmoment.locale('zh-cn');\n\navalon.component('ms-calendar', {\n    template: __inline('./ms-calendar.html'),\n    defaults: {\n        value: '',\n        $value: null,\n        $selected: null,\n        weekStart: 0,\n        showHeader: true,\n        disabledDate() { return false; },\n        \n        currentMonth: '',\n        currentYear: 0,\n        weekdays: [],\n        currentYearOptions: [],\n        monthOptions: [],\n        table: [],\n        handleYearChange(e) {\n            this.$value.year(e.target.value)\n            this.calcTable(this.$value.clone());\n        },\n        handleMonthChange(e) {\n            this.$value.month(e.target.value);\n            this.calcTable(this.$value.clone());\n        },\n        handleDateClick(el) {\n            if (el.disabled) {\n                return false;\n            }\n            this.$selected.year(this.currentYear).month(this.currentMonth).date(el.date);\n            if (el.prevMonth) {\n                this.$selected.subtract(1, 'months');\n            }\n            if (el.nextMonth) {\n                this.$selected.add(1, 'months');\n            }\n            this.$value = this.$selected;\n            this.onChange({\n                target: {\n                    value: this.$selected.clone()\n                },\n                type: 'calendar-changed'\n            });\n            // 是否有必要再计算更新一次？\n            this.calcTable(this.$value.clone());\n        },\n        onChange: avalon.noop,\n        calcTable(m: moment.Moment) {\n            let i, j;\n            // 这个月的第一天\n            const firstDayOfMonth = m.clone().startOf('month');\n            // 这个月的最后一天\n            const lastDayOfMonth = m.clone().endOf('month');\n            // 上个月的最后一天\n            const lastDayOfPrevMonth = firstDayOfMonth.clone().subtract(1, 'days');\n            const firstDay = (firstDayOfMonth.day() - this.weekStart + 7) % 7;\n            const prevLastDate = lastDayOfPrevMonth.date();\n            const lastDate = lastDayOfMonth.date();\n            const table = [];\n            let passed = 0;\n            for (i = 0; i < 6; i++) {\n                const tableRow = [];\n                for (j = 0; j < 7; j++) {\n                    const className = [];\n                    let disabled = false;\n                    let prevMonth = false;\n                    let nextMonth = false;\n                    if (i === 0 && j < firstDay) {\n                        // 上月结束部分\n                        className.push('ane-calendar-prev-month-cell');\n                        prevMonth = true;\n                        if (this.disabledDate(+m.clone().subtract(1, 'months').date(prevLastDate - firstDay + j + 1))) {\n                            disabled = true;\n                            className.push('ane-calendar-disabled-cell');\n                        }\n                        tableRow.push({\n                            className,\n                            disabled,\n                            prevMonth,\n                            nextMonth,\n                            date: prevLastDate - firstDay + j + 1\n                        });\n                    } else if (passed + 1 > lastDate) {\n                        // 下月开始部分\n                        className.push('ane-calendar-next-month-cell');\n                        nextMonth = true;\n                        if (this.disabledDate(+m.clone().add(1, 'months').date(passed + 1 - lastDate))) {\n                            disabled = true;\n                            className.push('ane-calendar-disabled-cell');\n                        }\n                        tableRow.push({\n                            className,\n                            disabled,\n                            prevMonth,\n                            nextMonth,\n                            date: ++passed - lastDate\n                        });\n                    } else {\n                        // 本月部分\n                        if (moment().isSame(m.clone().date(passed + 1), 'day')) {\n                            className.push('ane-calendar-today');\n                        }\n                        if (this.$selected.isSame(m.clone().date(passed + 1), 'day')) {\n                            className.push('ane-calendar-selected-day');\n                        }\n                        if (this.disabledDate(+m.clone().date(passed + 1))) {\n                            disabled = true;\n                            className.push('ane-calendar-disabled-cell');\n                        }\n                        tableRow.push({\n                            className,\n                            disabled,\n                            prevMonth,\n                            nextMonth,\n                            date: ++passed\n                        });\n                    }\n                }\n                table.push(tableRow);\n            }\n            this.table = table;\n            this.currentMonth = m.format('MMM');\n            this.currentYear = m.year();\n            this.currentYearOptions = avalon.range(this.currentYear - 10, this.currentYear + 9).map(y => ({ label: y, value: y }));\n        },\n        onInit(event) {\n            this.$value = moment();\n            this.$selected = moment();\n            const weekdays = moment.localeData().weekdaysMin();\n            avalon.range(this.weekStart).forEach(n => {\n                weekdays.push(weekdays.shift());\n            })\n            this.weekdays = weekdays;\n            const monthList = moment.localeData().monthsShort();\n            this.monthOptions = monthList.map(m => ({ label: m, value: m }));\n            this.calcTable(this.$value.clone());\n\n            this.value = this.$value.toArray().toString();\n            this.$watch('value', v => {\n                this.$value = this.$selected = moment(v.split(','));\n                this.calcTable(this.$value.clone());\n            });\n        }\n    }\n});"]}