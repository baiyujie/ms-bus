{"version":3,"sources":["/vendor/ane/components/ms-loading/ms-loading-directive.ts"],"names":[],"mappings":";;;AAAA,aAAkC;AAClC,6BAA2B;AAE3B;;;;;;;GAOG;AACH,GAA4B;IACxB,IAAI;QACA,IAAI,CAAC,QAAQ,EAAQ;QACrB,IAAI,CAAC,gBAAsB;IAC/B,CAAC;IACD,EAAkB;QAAlB,iBAmEC;QAlEG,EAAE,CAAC,CAAC,KAAK,CAAC,CAAC,CAAC;YACR,EAAE,CAAC,CAAC,CAAC,GAAgB;gBACjB,IAAM,GAAC,GAAG,OAAY;oBAClB,IAAM,GAAG,GAAG,IAAI,CAAC,GAAG,CAAC;oBACrB,IAAM,aAAa,EAA6E;oBAChG,IAAM,KAAK,GAAG,GAAG,CAAC,WAAW,EAAE,MAAM,GAAG,GAAG,CAAC,YAAY,EAAE,SAAS,GAAG,GAAG,CAAC,SAAS,CAAC;oBAEhF,mDAAe,EACf,6BAEc;oBAClB,KAAI,CAAC,gBAAgB,GAAG,GAAG,CAAC,KAAK,CAAC,QAAQ,CAAC;oBAE3C,iBAAiB;oBACjB,EAAE,CAAC,CAAC,OAAO,KAAK,CAAS;wBACrB,aAAa,CAAC,GAAC,CAAC,CAAC;oBACrB,CAAC;oBAED,CAA2B;oBAC3B,EAAE,CAAC,CAAC,KAAK,KAAK,CAAC,IAAI,MAAM,EAAS;wBAC9B,aAAa,CAAC,GAAC,CAAC,CAAC;oBACrB,CAAC;oBAAC,CAAM;wBACJ,EAAQ;oBACZ,CAAC;oBAED,CAAyD;oBACzD,WAAW,CAAC,SAAS,GAAG,kBAAkB,CAAC;oBAC3C,WAAW,CAAC,SAAS,GAAG,QAAQ,CAAC;oBACjC,WAAW,CAAC,KAAK,CAAC,IAAI,GAAG,CAAC,GAAG,CAAC,GAAuE;oBACrG,WAAW,CAAC,KAAK,CAAC,GAAG,GAAG,CAAC,GAAG,CAAC,cAAc,KAAK,QAAQ,GAAG,CAAC,GAAG,UAAU,CAAC,cAAc,CAAC,CAAC,GAAG,IAAI,CAAC;oBAClG,WAAW,CAAC,KAAK,CAAC,KAAK,GAAG,KAAK,GAAG,IAAI,CAAC;oBACvC,WAAW,CAAC,KAAK,CAAC,MAAM,GAAG,MAAM,GAAG,GAAK;oBACzC,WAAW,CAAC,KAAK,CAAC,UAAU,GAAG,MAAM,GAAG,CAAK;oBAE7C,GAAG,CAAC,KAAK,CAAC,QAAQ,GAAG,UAAU,CAAC;oBAChC,EAAE,CAAC,CAAC,CAAC,CAAC,OAAI,SAAS,MAAG,EAAC,EAAsB;wBACzC,GAAG,CAAC,SAAS,IAAI,SAAS,CAAC;oBAC/B,CAAC;oBACD,CAA6B;oBAC7B,KAAI,CAAC,QAAQ,GAAG,WAAW,CAAC;gBAChC,CAAC,EAAE,GAAG,CAAC,CAAC;YACZ,CAAC;YAAC,CAAM;gBACJ,EAAqB;gBACrB,IAAM,WAAW,GAAG,CAAc;gBAClC,IAAM,SAAS,GAAG,GAAG,CAAC,SAAS,CAAC;gBAChC,IAAI,CAAC,gBAAgB,GAAG,GAAG,CAAC,EAAe;gBAC3C,WAAW,CAAC,KAAK,CAAC,OAAO,GAAG,OAAO,CAAC;gBACpC,GAAG,CAAC,KAAK,CAAC,QAAQ,GAAG,UAAU,CAAC;gBAChC,EAAE,CAAC,CAAC,CAAC,CAAC,OAAI,SAAS,MAAG,EAAC,EAAsB;oBACzC,GAAG,CAAC,SAAS,GAAG,SAAS,GAAG,SAAS,CAAC;gBAC1C,CAAC;YACL,CAAC;QACL,CAAC;QAAC,CAAM;YACJ,EAAW;gBACP,EAAE,CAAC,CAAC,KAAI,CAAC,QAAQ,CAAC,CAAE;oBAChB,IAAM,GAAG,GAAG,IAAI,CAAC,EAAI;oBACrB,IAAM,WAAW,GAAG,CAAc;oBAClC,IAAM,SAAS,GAAG,GAAG,CAAC,SAAS,CAAC;oBAChC,WAAW,CAAC,KAAK,CAAC,OAAO,GAAG,EAAO;oBACnC,EAAE,CAAC,CAAC,KAAI,CAAC,gBAAgB,CAAC,CAAC,CAAC;wBACxB,GAAG,CAAC,KAAK,CAAC,QAAQ,GAAG,IAAsB;oBAC/C,CAAC;oBACD,CAA8D;gBAClE,CAAC;YACL,CAAC,EAAE,EAAK;QACZ,CAAC;IACL,CAAC;IACD,EAAa;QACT,IAAM,GAAG,GAAG,IAAI,CAAC,IAAI,CAAC,GAAG,CAAC;QAC1B,IAAI,CAAC,QAAQ,IAAI,GAAG,CAAC,GAA2B;IACpD,CAAC;CACJ,CAAC,CAAC;AAEH;;;;;;;;;;;GAWG;AACH,GAAsD;AACtD,IAAM,oBAAoB,GAGtB;IACA,IAAI,EAAE,EAAE,GAAG,EAAE,QAAQ,CAAC,EAAM;CAC/B,CAAC;AAEW,EAAU;IACnB,IAAI;QACA,EAAE,CAAC,CAAC,WAA8C;YAC9C,gBAAgB,CAAC,IAAI,CAAC,IAAI,CAAC,mBAAsB;YACjD,MAAM,CAAC,KAAK,CAAC;gBACT,gBAAgB,CAAC,KAAkC;oBAC/C,GAAG,EAAE,oBAAoB,CAAC,IAAI,CAAC,GAAG;iBACrC,EAAE,IAAI,CAAC,CAAC;YACb,CAAC,CAAC,CAAC;QACP,CAAC;QAAC,CAAM;YACJ,EAAmD;gBAC/C,GAAG,EAAE,oBAAoB,CAAC,IAAI,CAAC,GAAG;aACrC,EAAE,IAAI,CAAC,CAAC;QACb,CAAC;IACL,CAAC;IACD,EAAI;QACA,EAAE,CAAC,CAAC,WAA8C;YAC9C,gBAAgB,CAAC,MAAM,CAAC,IAAI,CAAC,iBAAsB;gBAC/C,GAAG,EAAE,oBAAoB,CAAC,IAAI,CAAC,GAAG;aACrC,EAAE,KAAK,CAAC,CAAC;QACd,CAAC;IACL,CAAC;CACJ,CAAC","file":"ms-loading-directive.js","sourcesContent":["import * as avalon from 'avalon2';\nimport './ms-loading.scss';\n\n/**\n * loading 指令\n * \n * @example\n * ``` html\n * <table :loading=\"true\">...</table>\n * ```\n */\navalon.directive('loading', {\n    init() {\n        this.instance = null;\n        this.oldPositionStyle = '';\n    },\n    update(vdom, value) {\n        if (value) {\n            if (!this.instance) {\n                const t = setInterval(() => {\n                    const dom = vdom.dom;\n                    const computedStyle = global.getComputedStyle ? global.getComputedStyle(dom) : dom.currentStyle;\n                    const width = dom.offsetWidth, height = dom.offsetHeight, className = dom.className;\n                    const {\n                        borderLeftWidth,\n                        borderTopWidth,\n                        display\n                    } = computedStyle;\n                    this.oldPositionStyle = dom.style.position;\n\n                    // 如果元素是隐藏的，什么都不做\n                    if (display === 'none') {\n                        clearInterval(t);\n                    }\n\n                    // 如果宽度和高度都不为0，则添加loading遮罩\n                    if (width !== 0 && height !== 0) {\n                        clearInterval(t);\n                    } else {\n                        return ;\n                    }\n\n                    const maskElement = global.document.createElement('div');\n                    maskElement.className = 'ane-loading-mask';\n                    maskElement.innerText = '加载中...';\n                    maskElement.style.left = 0 - (borderLeftWidth === 'medium' ? 0 : parseFloat(borderLeftWidth)) + 'px';\n                    maskElement.style.top = 0 - (borderTopWidth === 'medium' ? 0 : parseFloat(borderTopWidth)) + 'px';\n                    maskElement.style.width = width + 'px';\n                    maskElement.style.height = height + 'px';\n                    maskElement.style.lineHeight = height + 'px';\n\n                    dom.style.position = 'relative';\n                    if (!~` ${className} `.indexOf(' masked ')) {\n                        dom.className += ' masked';\n                    }\n                    dom.appendChild(maskElement);\n                    this.instance = maskElement;\n                }, 100);\n            } else {\n                const dom = vdom.dom;\n                const maskElement = this.instance;\n                const className = dom.className;\n                this.oldPositionStyle = dom.style.position;\n                maskElement.style.display = 'block';\n                dom.style.position = 'relative';\n                if (!~` ${className} `.indexOf(' masked ')) {\n                    dom.className = className + ' masked';\n                }\n            }\n        } else {\n            setTimeout(() => {\n                if (this.instance) {\n                    const dom = vdom.dom;\n                    const maskElement = this.instance;\n                    const className = dom.className;\n                    maskElement.style.display = 'none';\n                    if (this.oldPositionStyle) {\n                        dom.style.position = this.oldPositionStyle;\n                    }\n                    dom.className = ` ${className} `.replace(/\\s*masked\\s*/, ' ');\n                }\n            }, 100);\n        }\n    },\n    beforeDispose() {\n        const dom = this.node.dom;\n        this.instance && dom.removeChild(this.instance);\n    }\n});\n\n/**\n * 全局 loading 方法\n * \n * @example\n * ``` js\n * import { Loading } from './components/ms-loading';\n * Loading.show();\n * setTimeout(() => {\n *   Loading.hide();\n * }, 5000)\n * ```\n */\nconst loadingDirective = avalon.directives['loading'];\nconst globalLoadingContext: {\n    node: { dom: HTMLElement },\n    instance?: HTMLDivElement\n} = {\n    node: { dom: document.body }\n};\n\nexport const Loading = {\n    show() {\n        if (globalLoadingContext.instance === undefined) {\n            loadingDirective.init.call(globalLoadingContext);\n            avalon.ready(() => {\n                loadingDirective.update.call(globalLoadingContext, {\n                    dom: globalLoadingContext.node.dom\n                }, true);\n            });\n        } else {\n            loadingDirective.update.call(globalLoadingContext, {\n                dom: globalLoadingContext.node.dom\n            }, true);\n        }\n    },\n    hide() {\n        if (globalLoadingContext.instance !== undefined) {\n            loadingDirective.update.call(globalLoadingContext, {\n                dom: globalLoadingContext.node.dom\n            }, false);\n        }\n    }\n};"]}