{"version":3,"sources":["/vendor/ane/components/ms-control-select2/ms-control-select2.js"],"names":[],"mappings":"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","file":"ms-control-select2.js","sourcesContent":["var avalon = require('avalon');\nvar store = require('/services/storeService');\nvar avxUtil = require('/vendor/ane-component/ane-util');\n\n/**\n * @require /node_modules/select2/dist/css/select2.css\n * not require /node_modules/select2-bootstrap-theme/dist/select2-bootstrap.css\n */\nrequire('select2');\nrequire('/node_modules/select2/dist/js/i18n/zh-CN');\n\n/**\n * select2组件\n * @prop label 选择框前的label标签内容\n * @prop col 指定name属性值\n * @prop store 数据源，组件会自动寻找storeService.js中的配置\n * @prop action 指定使用数据源中的那个方法，默认为list\n * @prop col-key 数据中作为select的value属性值的字段，默认为id\n * @prop col-val 数据中作为select的展示值的字段，默认为name\n * @prop multiple 是否多选\n * @prop value-list 值列表，当multiple为true时有效，可通过ms-cprop双向绑定\n * \n * @example\n *  <ms:control-select2 label=\"图片尺寸\">\n *      <option value=\"1\">大图</option>\n *      <option value=\"2\">小图</option>\n *  </ms:control-select2>\n * \n * \n *  <ms:control-select2 label=\"商品分类\" store=\"category\"></ms:control-select2>\n * \n * <ms:control-select2 \n        label=\"代表作\" \n        col=\"masterpiece\" \n        ms-cprop-value-list=\"record.masterpiece\" \n        multiple=\"true\">\n    </ms:control-select2>\n */\navalon.component('ms:controlSelect2', {\n    $slot: 'content',\n    content: '',\n    $template: __inline('./ms-control-select2.html'),\n    $replace: 1,\n    $dynamicProp: {\n        duplex: { type: 'String' },\n        'value-list': { type: 'Array' }\n    },\n    $$template: function (tmpl) {\n        var vm = this;\n        var $parent = avalon.vmodels[this.parentVmId];\n        this.model = this.model || ($parent && $parent.model) || 'record';\n        if (vm.store) {\n            tmpl = tmpl.replace(/\\{\\{content\\|html\\}\\}/g, '<option ms-repeat=\"options\" ms-attr-value=\"el.id\" ms-attr-selected=\"el.selected\">{{el.text}}</option>');\n        }\n        return tmpl;\n    },\n    $init: function (vm, el) {\n        vm.$parentVmId = avxUtil.pickToRefs(vm, el);\n        avxUtil.enableDynamicProp(vm, el);\n        if (vm.store && !store[vm.store]) { avalon.error('配置了数据源，但数据源[' + vm.store + ']似乎未定义，/services/storeService.js') }\n\n        vm.$watch('duplex', function (v) {\n            if (vm.$select.val() == v) {\n                return ;\n            }\n            vm.$select.val(v).trigger('change');\n        });\n        vm.$watch('*', function (v, oldV, path) {\n            if (path === 'valueList') {\n                if (vm.$select.val().toString() == v.$model.toString()) {\n                    return ;\n                }\n                vm.$select.val(v.$model).trigger('change');\n            }\n        });\n    },\n    $ready: function (vm, el) {\n        vm.$select = $(el).find('select');\n        if (vm.store) {\n            if (vm.multiple) {\n                vm.options = [];\n                avalon.each(vm.valueList, function (i, n) {\n                    vm.options.push({ id: n, text: n });\n                });\n                vm.$select.val(vm.valueList.$model).trigger('change');\n            } else {\n                vm.options = [];\n                if (vm.duplex) {\n                    vm.options.push({ id: vm.duplex, text: vm.duplex, selected: true });\n                }\n                vm.$select.val(vm.duplex).trigger('change');\n            }\n        } else {\n            if (vm.multiple) {\n                vm.$select.val(vm.valueList.$model).trigger('change');\n            } else {\n                vm.$select.val(vm.duplex).trigger('change');\n            }\n        }\n        var select2Options = {\n            language: 'zh-CN',\n            placeholder: vm.placeholder,\n            allowClear: true\n        };\n        if (vm.store) {\n            avalon.mix(select2Options, {\n                ajax: {\n                    delay: 500,\n                    data: function (params) {\n                        return store[vm.store].processRequest({\n                            query: params.term,\n                            page: params.page || 1\n                        });\n                    },\n                    processResults: function (data, params) {\n                        params.page = params.page || 1;\n\n                        data = store[vm.store].processResponse(data, params);\n                        return {\n                            results: data.rows,\n                            pagination: {\n                                more: (params.page * (store[vm.store].limit || 30)) < data.total\n                            }\n                        };\n                    },\n                    transport: function (params, success, failure) {\n                        if (!store[vm.store][vm.action]) { avalon.error('数据源[' + vm.store + ']的[' + vm.action + ']方法没有定义，/services/storeService.js') }\n                        var request = store[vm.store][vm.action](params.data);\n                        request.then(success, failure);\n                    }\n                },\n                escapeMarkup: function (markup) { return markup; },\n                minimumInputLength: 1,\n                templateResult: function (r) {\n                    if (r.loading) return r.text;\n\n                    return r[vm.colVal]\n                },\n                templateSelection: function (r) {\n                    return r[vm.colKey] || r.text;\n                }\n            });\n        }\n        vm.$select\n            .select2(select2Options)\n            .on('change', function () {\n                if (vm.multiple) {\n                    vm.$dynamicProp['value-list'].setter(vm.$select.val());\n                } else {\n                    vm.$dynamicProp.duplex.setter(this.value);\n                }\n                $(this).trigger('input');\n            });\n    },\n    $dispose: function (vm, el) {\n        avxUtil.removeFromRefs(vm, el);\n        $(el).find('select').off().select2('destroy')\n    },\n    $parentVmId: '',\n    $select: {},\n    label: '',\n    col: '',\n    store: '',\n    action: '',\n    colKey: 'id',\n    colVal: 'name',\n    model: '',\n    placeholder: '请选择一项',\n    duplex: '',\n    valueList: [],\n    options: [],\n    multiple: false\n});"]}