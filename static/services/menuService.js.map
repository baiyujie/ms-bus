{"version":3,"sources":["/services/menuService.ts"],"names":[],"mappings":"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","file":"menuService.js","sourcesContent":["import * as avalon from  'avalon2';\r\nimport ajax from './ajaxService';\r\n\r\nconst menu = [{\r\n    key: 'dashboard',\r\n    title: '主页',\r\n    icon: 'fa fa-home',\r\n    uri: '/'\r\n}, {\r\n    key: 'demo1',\r\n    title: '例子一级',\r\n    icon: 'fa fa-home',\r\n    children: [{\r\n        key: 'demo',\r\n        title: '例子',\r\n        icon: 'fa fa-home',\r\n        uri: '/demo'\r\n    }, {\r\n        key: 'demo-redux',\r\n        title: 'redux例子',\r\n        icon: 'fa fa-home',\r\n        uri: '/demo-redux'\r\n    }, {\r\n        key: 'demo-fast',\r\n        title: '快速CURD例子',\r\n        icon: 'fa fa-home',\r\n        uri: '/demo-fast'\r\n    }]\r\n}, {\r\n    key: 'doc-ms',\r\n    title: '组件文档',\r\n    icon: 'fa fa-book',\r\n    children: [{\r\n        key: 'doc-ms-table',\r\n        title: 'Table',\r\n        uri: '/doc-ms-table'\r\n    }, {\r\n        key: 'doc-ms-form',\r\n        title: 'Form',\r\n        uri: '/doc-ms-form'\r\n    }]\r\n}, {\r\n    key: 'rxjs-demo-page',\r\n    title: 'RxJS Demo Page',\r\n    icon: 'fa fa-page',\r\n    uri: '/pages/rxjs-demo/rxjs-demo.html',\r\n    target: '_blank'\r\n}];\r\n\r\n// 根据权限过滤菜单\r\nconst menuPromise = new Promise((rs, rj) => {\r\n    ajax({\r\n        url: '/api/loged',\r\n        type: 'get'\r\n    }).then((result) => {\r\n        if (result.code === '0') {\r\n            $('#loadImg').css('display', 'none');\r\n            $('.login-area').removeClass('hidden').addClass('animated flipInX');\r\n            travelMenu(menu, result.data.t.functions, result.data.t.allowedFunctions);\r\n            avalon.mix(avalon.vmodels.root, { user: result.data.t });\r\n            rs(menu.slice(0));\r\n        } else {\r\n            rj(result);\r\n        }\r\n    });\r\n});\r\n\r\nfunction travelMenu(menulet, functions, allowedFunctions) {\r\n    if (!menulet) {\r\n        return ;\r\n    }\r\n    for (let i = 0, item; item = menulet[i++]; ) {\r\n        let hasPermission = false;\r\n        for (let j = 0, func; func = functions[j++]; ) {\r\n            if (func.code === item.name && (allowedFunctions[func.code]) || allowedFunctions['all']) {\r\n                item.uri = func.uri || item.uri || 'javascript:;';\r\n                item.icon = func.icon_url || item.icon;\r\n                item.target = item.target || '_self';\r\n                item.children = item.children || [];\r\n                item.opened = false;\r\n                hasPermission = true;\r\n                break;\r\n            }\r\n        }\r\n        item.show = hasPermission === true;\r\n\r\n        travelMenu(item.children, functions, allowedFunctions);\r\n    }\r\n}\r\n\r\nfunction walkMenu(name, process, level = 1, menuLet = menu.slice(0)) {\r\n    let finded = false;\r\n    for (let i = 0, item; item = menuLet[i++]; ) {\r\n        if (item.name === name || item.stateName === name) {\r\n            process && process(item, level);\r\n            finded = true;\r\n            break;\r\n        }\r\n        if (item.childStates && ~item.childStates.indexOf(name)) {\r\n            process && process(item, level);\r\n            finded = true;\r\n            break;\r\n        }\r\n        if (item.children && walkMenu(name, process, level + 1, item.children)) {\r\n            process && process(item, level);\r\n            finded = true;\r\n            break;\r\n        }\r\n    }\r\n    return finded;\r\n}\r\nexport {\r\n    walkMenu,\r\n    menuPromise as menu\r\n}"]}