{"version":3,"sources":["/services/menuService.ts"],"names":[],"mappings":";;;AAAA,gCAAmC;AACnC,6CAAiC;AAEjC,IAAM,IAAI,GAAG,CAAC;QACV,GAAG,EAAE,cAAc;QACnB,KAAK,EAAE,IAAI;QACX,IAAI,EAAE,YAAY;QAClB,GAAG,EAAE,GAAG;KACX,EAAE;QACC,GAAG,EAAE,OAAO;QACZ,KAAK,EAAE,MAAM;QACb,IAAI,EAAE,YAAY;QAClB,QAAQ,EAAE,CAAC;gBACP,GAAG,EAAE,SAAS;gBACd,KAAK,EAAE,IAAI;gBACX,IAAI,EAAE,YAAY;gBAClB,GAAG,EAAE,OAAO;aACf,EAAE;gBACC,GAAG,EAAE,eAAe;gBACpB,KAAK,EAAE,SAAS;gBAChB,IAAI,EAAE,YAAY;gBAClB,GAAG,EAAE,aAAa;aACrB,EAAE;gBACC,GAAG,EAAE,cAAc;gBACnB,KAAK,EAAE,UAAU;gBACjB,IAAI,EAAE,YAAY;gBAClB,GAAG,EAAE,YAAY;aACpB,CAAC;KACL,EAAE;QACC,GAAG,EAAE,QAAQ;QACb,KAAK,EAAE,MAAM;QACb,IAAI,EAAE,YAAY;QAClB,QAAQ,EAAE,CAAC;gBACP,GAAG,EAAE,cAAc;gBACnB,KAAK,EAAE,OAAO;gBACd,GAAG,EAAE,eAAe;aACvB,EAAE;gBACC,GAAG,EAAE,aAAa;gBAClB,KAAK,EAAE,MAAM;gBACb,GAAG,EAAE,cAAc;aACtB,CAAC;KACL,EAAE;QACC,GAAG,EAAE,gBAAgB;QACrB,KAAK,EAAE,gBAAgB;QACvB,IAAI,EAAE,cAAc;QACpB,GAAG,EAAE,iCAAiC;QACtC,MAAM,EAAE,QAAQ;KACnB,CAAC,CAAC;AAEH,WAAW;AACX,IAAM,WAAW,GAAG,IAAI,OAAO,CAAC,UAAC,EAAE,EAAE,EAAE;IACnC,wBAAI,CAAC;QACD,GAAG,EAAE,YAAY;QACjB,IAAI,EAAE,KAAK;KACd,CAAC,CAAC,IAAI,CAAC,UAAC,MAAM;QACX,EAAE,CAAC,CAAC,MAAM,CAAC,IAAI,KAAK,GAAG,CAAC,CAAC,CAAC;YACtB,CAAC,CAAC,UAAU,CAAC,CAAC,GAAG,CAAC,SAAS,EAAE,MAAM,CAAC,CAAC;YACrC,CAAC,CAAC,aAAa,CAAC,CAAC,WAAW,CAAC,QAAQ,CAAC,CAAC,QAAQ,CAAC,kBAAkB,CAAC,CAAC;YACpE,UAAU,CAAC,IAAI,EAAE,MAAM,CAAC,IAAI,CAAC,CAAC,CAAC,SAAS,EAAE,MAAM,CAAC,IAAI,CAAC,CAAC,CAAC,gBAAgB,CAAC,CAAC;YAC1E,MAAM,CAAC,GAAG,CAAC,MAAM,CAAC,OAAO,CAAC,IAAI,EAAE,EAAE,IAAI,EAAE,MAAM,CAAC,IAAI,CAAC,CAAC,EAAE,CAAC,CAAC;YACzD,EAAE,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,CAAC;QACtB,CAAC;QAAC,IAAI,CAAC,CAAC;YACJ,EAAE,CAAC,MAAM,CAAC,CAAC;QACf,CAAC;IACL,CAAC,CAAC,CAAC;AACP,CAAC,CAAC,CAAC;AA8DgB,2BAAI;AA5DvB,oBAAoB,OAAO,EAAE,SAAS,EAAE,gBAAgB;IACpD,EAAE,CAAC,CAAC,CAAC,OAAO,CAAC,CAAC,CAAC;QACX,MAAM,CAAE;IACZ,CAAC;IACD,GAAG,CAAC,CAAC,IAAI,CAAC,GAAG,CAAC,EAAE,IAAI,WAAE,IAAI,GAAG,OAAO,CAAC,CAAC,EAAE,CAAC,GAAI,CAAC;QAC1C,IAAI,aAAa,GAAG,KAAK,CAAC;QAC1B,GAAG,CAAC,CAAC,IAAI,CAAC,GAAG,CAAC,EAAE,IAAI,WAAE,IAAI,GAAG,SAAS,CAAC,CAAC,EAAE,CAAC,GAAI,CAAC;YAC5C,EAAE,CAAC,CAAC,IAAI,CAAC,IAAI,KAAK,IAAI,CAAC,IAAI,IAAI,CAAC,gBAAgB,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,CAAC;gBAC3D,IAAI,CAAC,GAAG,GAAG,IAAI,CAAC,GAAG,IAAI,IAAI,CAAC,GAAG,IAAI,cAAc,CAAC;gBAClD,IAAI,CAAC,IAAI,GAAG,IAAI,CAAC,QAAQ,IAAI,IAAI,CAAC,IAAI,CAAC;gBACvC,IAAI,CAAC,MAAM,GAAG,IAAI,CAAC,MAAM,IAAI,OAAO,CAAC;gBACrC,IAAI,CAAC,QAAQ,GAAG,IAAI,CAAC,QAAQ,IAAI,EAAE,CAAC;gBACpC,IAAI,CAAC,MAAM,GAAG,KAAK,CAAC;gBACpB,aAAa,GAAG,IAAI,CAAC;gBACrB,KAAK,CAAC;YACV,CAAC;YACD,EAAE,CAAC,CAAC,gBAAgB,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC;gBAC1B,aAAa,GAAG,IAAI,CAAC;YACzB,CAAC;QACL,CAAC;QACD,IAAI,CAAC,IAAI,GAAG,aAAa,KAAK,IAAI,CAAC;QAEnC,UAAU,CAAC,IAAI,CAAC,QAAQ,EAAE,SAAS,EAAE,gBAAgB,CAAC,CAAC;IAC3D,CAAC;AACL,CAAC;AAED,kBAAkB,IAAI,EAAE,GAAG,EAAE,OAAO,EAAE,KAAS;IAAT,iCAAS;IAC3C,IAAI,MAAM,GAAG,KAAK,CAAC;IACnB,GAAG,CAAC,CAAC,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,IAAI,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE,CAAC;QACnC,IAAM,IAAI,GAAG,IAAI,CAAC,CAAC,CAAC,CAAC;QACrB,OAAO,CAAC,IAAI,CAAC,CAAC;QACd,EAAE,CAAC,CAAC,IAAI,CAAC,GAAG,KAAK,GAAG,CAAC,CAAC,CAAC;YACnB,MAAM,GAAG,IAAI,CAAC;YACd,KAAK,CAAC;QACV,CAAC;QACD,EAAE,CAAC,CAAC,IAAI,CAAC,QAAQ,IAAI,QAAQ,CAAC,IAAI,CAAC,QAAQ,EAAE,GAAG,EAAE,OAAO,EAAE,KAAK,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC;YACpE,MAAM,GAAG,IAAI,CAAC;YACd,KAAK,CAAC;QACV,CAAC;QACD,OAAO,CAAC,EAAE,EAAE,IAAI,CAAC,CAAC;IACtB,CAAC;IAAA,CAAC;IACF,MAAM,CAAC,MAAM,CAAC;AAClB,CAAC;AACD,oBAAoB,GAAG;IACnB,MAAM,CAAC,WAAW,CAAC,IAAI,CAAC,UAAC,IAAS;QAC9B,IAAM,OAAO,GAAG,EAAE,CAAC;QAEnB,QAAQ,CAAC,IAAI,CAAC,MAAM,EAAE,EAAE,GAAG,EAAE,UAAU,IAAI,EAAE,KAAK;YAC9C,EAAE,CAAC,CAAC,KAAK,CAAC,CAAC,CAAC;gBACR,OAAO,CAAC,KAAK,EAAE,CAAC;YACpB,CAAC;YAAC,IAAI,CAAC,CAAC;gBACJ,OAAO,CAAC,OAAO,CAAC,IAAI,CAAC,CAAC;YAC1B,CAAC;QACL,CAAC,CAAC;QAEF,MAAM,CAAC,OAAO,CAAC;IACnB,CAAC,CAAC,CAAC;AACP,CAAC;AAEG,gCAAU","file":"menuService.js","sourcesContent":["import * as avalon from  'avalon2';\r\nimport ajax from './ajaxService';\r\n\r\nconst menu = [{\r\n    key: 'gf-dashboard',\r\n    title: '主页',\r\n    icon: 'fa fa-home',\r\n    uri: '/'\r\n}, {\r\n    key: 'demo1',\r\n    title: '例子一级',\r\n    icon: 'fa fa-home',\r\n    children: [{\r\n        key: 'gf-demo',\r\n        title: '例子',\r\n        icon: 'fa fa-home',\r\n        uri: '/demo'\r\n    }, {\r\n        key: 'gf-demo-redux',\r\n        title: 'redux例子',\r\n        icon: 'fa fa-home',\r\n        uri: '/demo-redux'\r\n    }, {\r\n        key: 'gf-demo-fast',\r\n        title: '快速CURD例子',\r\n        icon: 'fa fa-home',\r\n        uri: '/demo-fast'\r\n    }]\r\n}, {\r\n    key: 'doc-ms',\r\n    title: '组件文档',\r\n    icon: 'fa fa-book',\r\n    children: [{\r\n        key: 'doc-ms-table',\r\n        title: 'Table',\r\n        uri: '/doc-ms-table'\r\n    }, {\r\n        key: 'doc-ms-form',\r\n        title: 'Form',\r\n        uri: '/doc-ms-form'\r\n    }]\r\n}, {\r\n    key: 'rxjs-demo-page',\r\n    title: 'RxJS Demo Page',\r\n    icon: 'fa fa-circle',\r\n    uri: '/pages/rxjs-demo/rxjs-demo.html',\r\n    target: '_blank'\r\n}];\r\n\r\n// 根据权限过滤菜单\r\nconst menuPromise = new Promise((rs, rj) => {\r\n    ajax({\r\n        url: '/api/loged',\r\n        type: 'get'\r\n    }).then((result) => {\r\n        if (result.code === '0') {\r\n            $('#loadImg').css('display', 'none');\r\n            $('.login-area').removeClass('hidden').addClass('animated flipInX');\r\n            travelMenu(menu, result.data.t.functions, result.data.t.allowedFunctions);\r\n            avalon.mix(avalon.vmodels.root, { user: result.data.t });\r\n            rs(menu.slice(0));\r\n        } else {\r\n            rj(result);\r\n        }\r\n    });\r\n});\r\n\r\nfunction travelMenu(menulet, functions, allowedFunctions) {\r\n    if (!menulet) {\r\n        return ;\r\n    }\r\n    for (let i = 0, item; item = menulet[i++]; ) {\r\n        let hasPermission = false;\r\n        for (let j = 0, func; func = functions[j++]; ) {\r\n            if (func.code === item.name && (allowedFunctions[func.code])) {\r\n                item.uri = func.uri || item.uri || 'javascript:;';\r\n                item.icon = func.icon_url || item.icon;\r\n                item.target = item.target || '_self';\r\n                item.children = item.children || [];\r\n                item.opened = false;\r\n                hasPermission = true;\r\n                break;\r\n            }\r\n            if (allowedFunctions['all']) {\r\n                hasPermission = true;\r\n            }\r\n        }\r\n        item.show = hasPermission === true;\r\n\r\n        travelMenu(item.children, functions, allowedFunctions);\r\n    }\r\n}\r\n\r\nfunction walkMenu(menu, key, process, level = 1) {\r\n    let finded = false;\r\n    for (let i = 0; i < menu.length; i++) {\r\n        const item = menu[i];\r\n        process(item);\r\n        if (item.key === key) {\r\n            finded = true;\r\n            break;\r\n        }\r\n        if (item.children && walkMenu(item.children, key, process, level + 1)) {\r\n            finded = true;\r\n            break;\r\n        }\r\n        process('', true);\r\n    };\r\n    return finded;\r\n}\r\nfunction getKeyPath(key) {\r\n    return menuPromise.then((menu: any) => {\r\n        const keyPath = [];\r\n\r\n        walkMenu(menu.toJSON(), key, function (item, shift) {\r\n            if (shift) {\r\n                keyPath.shift();\r\n            } else {\r\n                keyPath.unshift(item);\r\n            }\r\n        })\r\n\r\n        return keyPath;\r\n    });\r\n}\r\nexport {\r\n    getKeyPath,\r\n    menuPromise as menu\r\n}"]}